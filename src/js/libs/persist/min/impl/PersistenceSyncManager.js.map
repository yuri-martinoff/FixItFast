{"version":3,"sources":["../../../src/impl/PersistenceSyncManager.js"],"names":["define","require","persistenceUtils","persistenceStoreManager","cacheHandler","logger","PersistenceSyncManager","isOnline","browserFetch","cache","Object","defineProperty","this","value","writable","_getSyncLog","persistenceSyncManager","self","Promise","resolve","reject","_findSyncLogRecords","then","results","_generateSyncLog","syncLog","_readingSyncLog","catch","err","_checkURL","request","preflightOptionsRequestOption","_options","preflightOptionsRequestTimeoutOption","url","match","_pingedURLs","indexOf","_preflightOptionsRequestId","Date","getTime","preflightOptionsRequestId","_repliedOptionsRequest","preflightOptionsRequest","Request","method","requestTimeout","setTimeout","_browserFetch","result","push","_checkStopSync","syncEventResult","action","_reorderSyncLog","requestObjArray","length","i","reorderedRequestObjArray","_createSyncLogEntry","requestId","undo","_undoLocalStore","redo","_redoLocalStore","_getSyncLogStorage","store","find","_getSyncLogFindExpression","requestData","syncLogArray","getRequestArray","requestDataArray","metadata","created","toString","requestFromJSON","shift","_getRequestFromSyncLog","getSyncLog","syncLogCount","findExpression","fieldsExpression","sortExpression","sort","fields","selectorExpression","existsExpression","selector","_getRedoUndoStorage","redoUndoStore","findByKey","redoUndoDataArray","_updateLocalStore","isUndo","j","operation","storeName","undoRedoData","undoRedoDataCount","dataArray","redoUndoDataArrayCount","applyUndoRedoItem","key","openStore","upsertAll","removeByKey","_dispatchEvent","eventType","event","_callEventListener","_eventListeners","filter","_eventFilterFunction","eventListener","toLowerCase","type","scope","eventListeners","listener","slice","_getStorage","name","options","index","prototype","addEventListener","removeEventListener","insertRequest","localVars","requestToJSON","_noClone","constructMetadata","upsert","undoRedoDataArray","storeUndoRedoData","removeRequest","updateRequest","all","values","sync","_syncing","syncPromise","_isOnline","requestClone","statusCode","replayRequestArray","requests","clone","eventResult","response","status","error","statusText","_cloneResponse","responseClone","dispatchEventResult","_cache","put","log","init","Response"],"mappings":"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","file":"PersistenceSyncManager.js"}