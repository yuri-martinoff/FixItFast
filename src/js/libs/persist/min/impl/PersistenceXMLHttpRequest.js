/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
define(["../persistenceUtils","./logger"],function(a,b){"use strict";function c(a){var b=this;Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_browserXMLHttpRequest",{value:a}),Object.defineProperty(this,"_method",{value:null,writable:!0}),Object.defineProperty(this,"onreadystatechange",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"ontimeout",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"_password",{value:null,writable:!0}),Object.defineProperty(this,"_readyState",{value:0,writable:!0}),Object.defineProperty(this,"readyState",{enumerable:!0,get:function(){return b._readyState}}),Object.defineProperty(this,"_requestHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_response",{value:"",writable:!0}),Object.defineProperty(this,"response",{enumerable:!0,get:function(){return b._response}}),Object.defineProperty(this,"_responseHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_responseText",{value:null,writable:!0}),Object.defineProperty(this,"responseText",{enumerable:!0,get:function(){return b._responseText}}),Object.defineProperty(this,"responseType",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"_responseURL",{value:"",writable:!0}),Object.defineProperty(this,"responseURL",{enumerable:!0,get:function(){return b._responseURL}}),Object.defineProperty(this,"_responseXML",{value:null,writable:!0}),Object.defineProperty(this,"responseXML",{enumerable:!0,get:function(){return b._responseXML}}),Object.defineProperty(this,"_status",{value:0,writable:!0}),Object.defineProperty(this,"status",{enumerable:!0,get:function(){return b._status}}),Object.defineProperty(this,"_statusText",{value:"",writable:!0}),Object.defineProperty(this,"statusText",{enumerable:!0,get:function(){return b._statusText}}),Object.defineProperty(this,"timeout",{value:0,enumerable:!0}),Object.defineProperty(this,"upload",{value:null,enumerable:!0}),Object.defineProperty(this,"_url",{value:null,writable:!0}),Object.defineProperty(this,"_username",{value:null,writable:!0}),Object.defineProperty(this,"withCredentials",{value:!1,enumerable:!0,writable:!0})}function d(a,b){a._readyState=b,"function"==typeof a.onreadystatechange&&a.onreadystatechange(new k("readystatechange")),a.dispatchEvent(new k("readystatechange")),a._readyState==c.DONE&&(a.dispatchEvent(new k("load",!1,!1,a)),a.dispatchEvent(new k("loadend",!1,!1,a)))}function e(a){var b=a.toLowerCase();if(0===b.indexOf("http:")||0===b.indexOf("https:"))return!1;if(0===b.indexOf("file:"))return!0;if(URL&&URL.prototype)b=new URL(a,window.location.href).origin;else{var c=document.createElement("a");c.href=a,b=c.protocol}return!(!b||0!==b.toLowerCase().indexOf("file:"))}function f(a){function b(b){c.append(b,a._requestHeaders[b])}var c=new Headers;return Object.keys(a._requestHeaders).forEach(b),c}function g(a,b){var c=f(a),d=a.withCredentials?"include":"omit",e={method:a._method,headers:c,mode:"cors",cache:"default",credentials:d};return"GET"!==a._method&&"HEAD"!==a._method&&"DELETE"!==a._method&&(e.body=b),e}function h(e,f,g){i(e,g.headers);var h=g.headers.get("Content-Type");e._status=g.status,e._statusText=g.statusText,e._responseURL=f.url,!a._isTextPayload(g.headers)&&a.isCachedResponse(g)?g.blob().then(function(a){e._responseType="blob",e._response=a,d(e,c.DONE),"function"==typeof e.onload&&e.onload()},function(a){b.error(a)}):h&&-1!==h.indexOf("image/")?g.arrayBuffer().then(function(a){e._responseType="arrayBuffer",e._response=a,d(e,c.DONE),"function"==typeof e.onload&&e.onload()},function(a){b.error("error reading response as arrayBuffer!")}):g.text().then(function(a){e._responseType="",e._response=a,e._responseText=a,d(e,c.DONE),"function"==typeof e.onload&&e.onload()},function(a){b.error(a)})}function i(a,b){if(a._responseHeaders={},b.entries){var e,f,g,h=b.entries();do{e=h.next(),e.value&&(f=e.value[0],g=e.value[1],a._forceMimeType&&"content-type"==f.toLowerCase()?a._responseHeaders[f]=a._forceMimeType:a._responseHeaders[f]=g)}while(!e.done)}else b.forEach&&b.forEach(function(b,c){a._forceMimeType&&"content-type"==c.toLowerCase()?a._responseHeaders[c]=a._forceMimeType:a._responseHeaders[c]=b});d(a,c.HEADERS_RECEIVED)}function j(a){if(a._readyState!==c.OPENED)throw new Error("INVALID_STATE_ERR")}function k(a,b,c,d){Object.defineProperty(this,"type",{value:a,enumerable:!0}),Object.defineProperty(this,"bubbles",{value:b,enumerable:!0}),Object.defineProperty(this,"cancelable",{value:c,enumerable:!0}),Object.defineProperty(this,"target",{value:d,enumerable:!0})}return Object.defineProperty(c,"UNSENT",{value:0,enumerable:!0}),Object.defineProperty(c,"OPENED",{value:1,enumerable:!0}),Object.defineProperty(c,"HEADERS_RECEIVED",{value:2,enumerable:!0}),Object.defineProperty(c,"LOADING",{value:3,enumerable:!0}),Object.defineProperty(c,"DONE",{value:4,enumerable:!0}),c.prototype.open=function(a,b,f,g,h){if("boolean"==typeof f&&!f)throw new Error("InvalidAccessError: Failed to execute 'open' on 'XMLHttpRequest': Synchronous requests are disabled on the XHR Adapter");if(this._method=a,this._url=b,e(b)){var i=this;this._passthroughXHR=new i._browserXMLHttpRequest,this._passthroughXHR.onreadystatechange=function(){i._passthroughXHR.readyState==c.DONE&&(i._status=i._passthroughXHR.status,i._statusText=i._passthroughXHR.statusText,i._response=i._passthroughXHR.response,i._responseHeaders=i._passthroughXHR.responseHeaders,i._responseText=i._passthroughXHR.responseText,i._responseType=i._passthroughXHR.responseType,i._responseURL=i._passthroughXHR.responseURL,i._responseXML=i._passthroughXHR.responseXML),d(i,i._passthroughXHR.readyState)},this._passthroughXHR.open(a,b,f,g,h)}else this._passthroughXHR=null;this._username=g,this._password=h,this._responseText=null,this._responseXML=null,this._requestHeaders={},d(this,c.OPENED)},c.prototype.setRequestHeader=function(a,b){j(this);var c=this._requestHeaders[a];this._requestHeaders[a]=c?c+=","+b:b},c.prototype.send=function(a){if(this._passthroughXHR)this._passthroughXHR.send(a);else{j(this),d(this,c.OPENED);var e=g(this,a),f=new Request(this._url,e),i=this;fetch(f).then(function(a){h(i,f,a)},function(a){b.error(a)}),this.dispatchEvent(new k("loadstart",!1,!1,this))}},c.prototype.abort=function(){b.log("abort() is not supported by the XHR Adapter")},c.prototype.getResponseHeader=function(a){if(this._readyState<c.HEADERS_RECEIVED)return null;a=a.toLowerCase();for(var b in this._responseHeaders)if(b.toLowerCase()==a.toLowerCase())return this._responseHeaders[b];return null},c.prototype.getAllResponseHeaders=function(){function a(a){d+=a+": "+b._responseHeaders[a]+"\r\n"}var b=this;if(this._readyState<c.HEADERS_RECEIVED)return"";var d="";return Object.keys(this._responseHeaders).forEach(a),d},c.prototype.overrideMimeType=function(a){"string"==typeof a&&(this._forceMimeType=a.toLowerCase())},c.prototype.addEventListener=function(a,b){this._eventListeners[a]=this._eventListeners[a]||[],this._eventListeners[a].push(b)},c.prototype.removeEventListener=function(a,b){var c,d=this._eventListeners[a]||[],e=d.length;for(c=0;c<e;c++)if(d[c]==b)return d.splice(c,1)},c.prototype.dispatchEvent=function(a){var b=this,c=a.type;return(this._eventListeners[c]||[]).forEach(function(c){"function"==typeof c?c.call(b,a):c.handleEvent(a)}),!!a.defaultPrevented},k.prototype.stopPropagation=function(){},k.prototype.preventDefault=function(){this.defaultPrevented=!0},c});
//# sourceMappingURL=PersistenceXMLHttpRequest.js.map