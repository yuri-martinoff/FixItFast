/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
define(["./persistenceManager","./persistenceUtils"],function(a,b){"use strict";function c(){return function(a,b){return new Promise(function(c,i){d(a,b).then(function(b){return e(a,b)}).then(function(b){return f(a,b)}).then(function(b){return g(a,b)}).then(function(b){return h(a,b)}).then(function(b){return j(a,b)}).then(function(a){c(a)})})}}function d(a,c){var d=c.headers.get("Expires"),e=c.headers.get("x-oracle-jscpt-cache-expiration-date");return!d||!b.isCachedResponse(c)||e&&0!=e.length||c.headers.set("x-oracle-jscpt-cache-expiration-date",d),Promise.resolve(c)}function e(a,c){var d=k(c.headers,"max-age");if(null!=d&&b.isCachedResponse(c)){var e=a.headers.get("Date");e||(e=(new Date).toUTCString());var f=new Date(e).getTime(),g=f+1e3*d,h=new Date(g);c.headers.set("x-oracle-jscpt-cache-expiration-date",h.toUTCString())}return Promise.resolve(c)}function f(c,d){var e=c.headers.get("If-Match"),f=c.headers.get("If-None-Match");if(e||f){if(a.isOnline())return new Promise(function(a,b){l(c,d,!1).then(function(b){a(b)},function(a){b(a)})});var g=d.headers.get("ETag");if(e&&g.indexOf(e)<0)return new Promise(function(a,c){b.responseToJSON(d).then(function(a){return a.status=412,a.statusText="If-Match failed due to no matching ETag while offline",b.responseFromJSON(a)}).then(function(b){a(b)})});if(f&&g.indexOf(f)>=0)return new Promise(function(a,c){b.responseToJSON(d).then(function(a){return a.status=412,a.statusText="If-None-Match failed due to matching ETag while offline",b.responseFromJSON(a)}).then(function(b){a(b)})})}return Promise.resolve(d)}function g(a,b){if(k(b.headers,"must-revalidate")){var c=b.headers.get("x-oracle-jscpt-cache-expiration-date");if(c){var d=new Date(c).getTime();if((new Date).getTime()>d)return l(a,b,!0)}}return Promise.resolve(b)}function h(a,b){return i(a,b)?l(a,b):Promise.resolve(b)}function i(a,b){if(k(b.headers,"no-cache"))return!0;var c=a.headers.get("Pragma");return c&&"no-cache"===c.trim()}function j(a,c){return null!=k(c.headers,"no-store")?(b.isCachedResponse(c)&&c.headers.delete("x-oracle-jscpt-cache-expiration-date"),Promise.resolve(c)):m(a,c)}function k(a,b){var c=a.get("Cache-Control");if(c){var d,e,f,g=c.split(",");for(d=0;d<g.length;d++)if(e=g[d].trim(),0===e.indexOf(b))return f=e.split("="),!(f.length>1)||f[1].trim()}return null}function l(c,d,e){return b.isCachedResponse(d)?a.isOnline()?new Promise(function(b,e){a.browserFetch(c).then(function(e){304==e.status?b(d):a.getCache().delete(c).then(function(){b(e)})},function(a){e(a)})}):e?new Promise(function(a,c){b.responseToJSON(d).then(function(a){return a.status=504,a.statusText="cache-control: must-revalidate failed due to application being offline",b.responseFromJSON(a)}).then(function(b){a(b)})}):Promise.resolve(d):Promise.resolve(d)}function m(c,d){return new Promise(function(e,f){if(null==d||b.isCachedResponse(d)||"GET"!=c.method&&"HEAD"!=c.method)e(d);else{var g=d.clone();a.getCache().put(c,d).then(function(){e(g)})}})}return{getHttpCacheHeaderStrategy:c}});
//# sourceMappingURL=cacheStrategies.js.map